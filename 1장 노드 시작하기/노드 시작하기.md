# 핵심 개념 이해하기

1. Node.js는 크롬 V8 자바스크립트 엔진으로 빌드된 자바스크립트 런타임입니다.  
   Node.js는 이벤트 기반, 논블로킹 I/O 모델을 사용해 가볍고 효율적입니다.  
   Node.js의 패키지 생태계인 npm은 세계에서 가장 큰 오픈 소스 라이브러리 생태계이기도 합니다.

   ### 1. 서버

   노드를 통해 다양한 자바스크립트 애플리케이션을 실행할 수 있지만, 노드는 서버 애플리케이션을 실행하는 데 제일 많이 사용됩니다.  
   노드는 자바스크립트 애플리케이션이 서버로서 기능하기 위한 도구를 제공하므로 서버 역할을 수행할 수 있습니다.

   ### 2. 노드의 특성

   1. 노드는 자바스크립트 런타임입니다.
      - 런타임은 특정 언어로 만든 프로그램을 실행할 수 있는 환경을 뜻합니다.  
        따라서 노드는 자바스크립트 프로그램을 컴퓨터에서 실행할 수 있게 해줍니다.
      - 기존에는 자바스크립트 프로그램을 인터넷 브라우저(브라우저도 자바스크립트 런타임입니다) 위에서만 실행할 수 있었습니다.
      - 노드는 v8과 더불어 libuv라는 라이브러리를 사용합니다. v8과 libuv는 C와 C++로 구현되어 있습니다. **_우리가 코딩한 자바스크립트 코드는 노드가 V8과 libuv에 연결해주므로 노드를 사용할 때 C와 C++은 몰라도 됩니다._**
   2. 이벤트 기반
      - 이벤트 기반(event-driven)이란 이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식을 의미합니다. 이벤트로는 클릭이나 네트워크 요청 등이 있을 수 있습니다.
      - 이벤트 기반 시스템에서는 특정 이벤트가 발생할 때 무엇을 할지 미리 등록해두어야 합니다. 이것을 이벤트 리스너(event listener)에 콜백(callback) 함수를 등록한다고 표현합니다.
      - 노드도 이벤트 기반 방식으로 동작하므로 이벤트가 발생하면 이벤트 리스너에 등록해둔 콜백 함수를 호출합니다. 발생한 이벤트가 없거나 발생했던 이벤트를 다 처리하면 노드는 다음 이벤트가 발생할 때까지 대기합니다.
      - **_이벤트 루프 개념_**
        - 여러 이벤트가 동시에 발생했을 때 어떤 순서로 콜백 함수를 호출할지를 이벤트 루프가 판단합니다.
        - 이벤트 발생 시 호출할 콜백 함수들을 관리하고, 호출된 콜백 함수의 실행 순서를 결정하는 역할을 담당합니다. 노드가 종료될 때까지 이벤트 처리를 위한 작업을 반복하므로 루프라고 불립니다.
      - **_태스크 큐_**
        - 이벤트 발생 후 호출되어야 할 콜백 함수들이 기다리는 공간입니다. 콜백들이 이벤트 루프가 정한 순서대로 줄을 서 있으므로 콜백 큐라고 부릅니다.
      - **_백그라운드_**
        - 타이머나 I/O 작업 콜백 또는 이벤트 리스너들이 대기하는 곳입니다.
   3. 논블로킹 I/O

      - 이벤트 루프를 잘활용하면 오래 걸리는 작업을 효율적으로 처리할 수 있습니다.  
        오래 걸리는 함수를 백그라운드로 보내서 다음 코드가 먼저 실행되게 하고, 그 함수가 다시 태스크 큐를 거쳐 호출 스택으로 올라오기를 기다리는 방식입니다. 이 방식이 논블로킹 방식입니다. **_논블로킹이란 이전 작업이 완료될 때까지 멈추지 않고 다음 작업을 수행함을 뜻합니다._**
      - ```
            function longRunningTask() {
                //오래 걸리는 작업
                console.log('작업 끝');
            }

            console.log('시작');
            setTimeout(longRunningTask, 0); //코드를 논블로킹으로 만들기 위해 사용하는 기법 중 하나입니다.
            console.log('다음 작업');
        ```

   4. 싱글 스레드

   - 노드는 싱글 스레드이므로 주어진 작업을 혼자서 처리해야 합니다. 반대로 멀티 스레드인 시스템에서는 여러개의 스레드가 일을 나눠서 처리할 수 있습니다.
   - 멀티 스레드가 모두 논블로킹 방식으로 일을 처리하면 좋지 않을까? 하는 의문이 들 수 있습니다. 실제로 그렇습니다. 노드도 싱글 스레드 여러 개를 사용해 멀티 스레딩과 비슷한 기능을 하게 할 수 있습니다. 하지만 엄밀히 말하면 멀티 스레딩이라기보다는 멀티 프로세싱에 가깝습니다.
     - 프로세스
       - 프로세스는 **_운영체제에서 할당하는 작업의 단위 입니다._** 노드나 인터넷 브라우저 같은 프로그램은 개별적인 프로세스입니다. **_프로세스 간에는 메모리 등의 자원을 공유하지 않습니다._**
     - 스레드
       - 스레드는 **_프로세스 내에서 실행되는 흐름의 단위입니다._** 하나의 프로세스는 스레드를 여러개 가질 수 있습니다. 스레드들은 **_부모 프로세스의 자원을 공유 합니다. 즉, 같은 메모리에 접근할 수 있습니다._**
   - 사실 노드 프로세스도 내부적으로는 스레드를 여러 개 가지고 있습니다. 하지만 여러분이 직접 제어할 수 있는 스레드는 하나뿐이므로 흔히 싱글 스레드라고 부르는 것입니다.
   - 노드는 스레드를 늘리는 대신, 프로세스 자체를 복사해 여러 작업을 동시에 처리하는 멀티 프로세싱 방식을 택했습니다. 추후 cluster 모듈과 pm2 패키지에서 멀티 프로세싱을 가능하게 하는 방법에 대해 알아봅시다.

# 서버로서의 노드

노드가 싱글 스레드, 논블로킹 모델을 사용하므로 노드 서버 또한 동일한 모델일 수 밖에 없습니다.  
따라서 노드 서버의 장단점은 싱글 스레드, 논블로킹 모델의 장단점과 크게 다르지 않습니다.

노드 장단점

1. 싱글 스레드여서 멀티 스레드 방식보다는 컴퓨터 작원을 적게 사용하는 장점이 있지만, CPU 코어를 하나밖에 사용하지 못하는 단점도 있습니다.
2. 노드 서버는 I/O가 많은 작업에 적합합니다. 노드는 libuv 라이브러리를 사용하여 I/O 작업을 논블로킹 방식으로 처리해줍니다.  
   따라서 스레드 하나가 많은 수의 I/O를 혼자서도 감당할 수 있습니다.  
   **_하지만 CPU 부하가 큰 작업에는 적합하지 않습니다. 여러분이 작성하는 코드는 모두 스레드 하나에서 처리됩니다. 여러분의 코드가 CPU 연산을 많이 요구하면 블로킹이 발생해 스레드 하나가 감당하기 어렵습니다._**
3. 싱글 스레드 방식의 프로그래밍은 멀티 스레드 방식보다 상대적으로 쉽습니다. 서버 프로그래밍에 익숙하지 않은 사람도 쉽게 입문할 수 있습니다.  
   하지만 싱글 스레드이다 보니 하나뿐인 스레드가 에러로 인해 멈추지 않도록 잘 관리해야 합니다. 에러를 제대로 처리하지 못하면 서버 전체가 멈추기 때문입니다.
4. 웹 서버가 내장되어 있어 입문자가 쉽게 접근할 수 있습니다. 노드 외의 서버를 개발하다 보면 Apache, nginx, IIS처럼 별도의 웹서버를 설치해야 하는 경우가 많습니다. 심지어 Tomcat 같은 웹 어플리케이션 서버(WAS)를 추가로 설치하는 경우도 있습니다. 이 경우 프로그래밍 외에도 웹서버와 WAS 사용법을 익혀야 합니다. 하지만 노드는 내장된 웹 서버를 사용하면 되므로 편리합니다.
5. 가장 큰 장점은 자바스크립트를 사용한다는 것입니다. 웹 브라우저도 자바스크립트를 사용하므로 서버까지 노드를 사용하면 하나의 언어로 웹 사이트를 개발할 수 있습니다. 이는 개발 생산성을 획기적으로 높여주었고, 생산성이 중요한 기업이 노드를 채택하는 이유가 되었습니다.

|                                                  |                                              |
| ------------------------------------------------ | -------------------------------------------- |
| 장점                                             | 단점                                         |
| 멀티스레드 방식에 비해 컴퓨터 자원을 적게 사용함 | 싱글 스레드라서 CPU 코어를 하나만 사용함     |
| I/O 작업이 많은 서버로 적합                      | CPU 작업이 많은 서버로는 부적합              |
| 멀티 스레드 방식보다 쉬움                        | 하나뿐인 스레드가 멈추지 않도록 관리해야 함  |
| 웹 서버가 내장되어 있음                          | 서버 규모가 커졌을 때 서버를 관리하기 어려움 |
| 자바스크립트를 사용함                            | 어중간한 성능                                |
| JSON 형식과 호환하기 쉬움                        |                                              |

**_이와 같은 노드의 장점을 활요하려면 어디에 사용해야 할까요? 개수는 많지만 크기는 작은 데이터를 실시간으로 주고 받는 데 적합합니다. 네트워크나 데이터베이스, 디스크 작업 같은 I/O에 특화되어 있기 때문입니다. 실시간 채팅 애플리케이션이나 주식 차트, JSON 데이터를 제공하는 API 서버가 노드를 많이 사용합니다._**

**_이미지나 비디오 처리, 대규모 데이터 처리 같이 CPU를 많이 사용하는 서버로는 권장하지 않습니다._**

# 서버 외의 노드

노드는 자바스크립트 런타임이기 때문에 용도가 서버에만 한정된 것은 아닙니다.

# 개발 환경 설정하기

### 1. 노드 설치하기

### 2. npm의 버전 업데이트 하기

1. npm install -g npm

# 기타

1. 이벤트 루프에 대한 시각적 설명
   - http://latentflip.com/loupe
2. 이벤트 루프에 대한 설명
   - https://nodejs.org/ko/docs/guides/event-loop-timers-and-nexttick/
