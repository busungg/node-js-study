# REPL 사용하기

자바스크립트는 스크립트 언어이므로 미리 컴파일을 하지 않아도 즉석에서 코드를 실행할 수 있습니다. 이전 장에서 브라우저 콘솔 탭에서 자바스크립트 코드를 입력보았을 것입니다.  
노드도 비슷한 콘솔을 제공하는데, 입력한 코드를 읽고(Read), 해석하고(Eval), 결과물을 반환하고(Print), 종료할 때까지 반복(Loop)한다고 해서 REPL(Read Eval Print Loop)이라고 부릅니다.
노드의 REPL을 직접 사용해보겠습니다. 윈도에서는 명령 프롬프트, 맥이나 리눅스에서는 터미널을 열고 node를 입력합니다. VS Code에서는 Ctrl + `를 누르면 터미널을 켤 수 있습니다. 앞으로는 명령 프롬프트나 터미널을 콘솔이라고 통칭하겠습니다.  
REPL을 종료하려면 Ctrl + C를 두 번 누르거나, REPL 창에 .exit를 입력하면 됩니다.

# JS 파일 실행하기

REPL에 직접 코드를 입력하는 대신 자바스크립트 파일을 만들어 실행해보겠습니다. 다음과 같은 자바스크립트 파일을 만들어봅시다. 파일은 아무 폴더(디렉터리) 안에 만들어도 됩니다. 하지만 예제 코드가 많으니 따로 폴더를 만들어 파일들을 모아두는 것이 편리할 것입니다.
콘솔에서 node [자바스크립트 파일 경로]로 실행합니다. 확장자(.js)는 생략해도 됩니다. REPL에서 입력하는 것이 아니므로 주의하세요. REPL이 아니라 콘솔에서 입력해야 합니다. 콘솔에서 REPL로 들어가는 명령어가 node고, 노드를 통해 파일을 실행하는 명령어는 node [자바스크립트 파일 경로]입니다.

```
    node helloWorld
```

# 모듈로 만들기

노드는 코드를 모듈로 만들 수 있다는 점에서 브라우저의 자바스크립트와는 다릅니다. 모듈이란 특정한 기능을 하는 함수나 변수들의 집합입니다. 자체로도 하나의 프로그램이면서 다른 프로그램의 부품으로도 사용할 수 있습니다.
모듈로 만들어두면 여러 프로그램에 해당 모듈을 재사용할 수 있습니다. 자바스크립트에서 코드를 재사용하기 위해 함수로 만드는 것과 비슷합니다.  
**_require 함수 안에 불러올 모듈의 경로를 적어줍니다. 앞의 예제에서는 같은 폴더 안에 파일을 만들었지만, 다른 폴더에 있는 파일도 모듈로 사용할 수 있습니다. require 함수의 인자로 제공하는 경로만 잘 지정해주면 됩니다. 파일 경로에서 js나 json 같은 확장자는 생략할 수 있습니다._**

# 노드 내장 객체 알아보기

### 1. global

브라우저의 window와 같은 전역 개체입니다. 전역 객체이므로 모든 파일에서 접근할 수 있습니다. 또한, window.open 메서드를 그냥 open으로 호출할 수 있는 것처럼 global도 생략할 수 있습니다.
이전 절에서 사용했던 require 함수에서도 global.require에서 global이 생략된 것입니다.
노드 콘솔에 로그를 기록하는 console 객체도 원래는 global.console입니다.  
global 객체 내부에는 매우 많은 속성이 들어 있습니다. 이 절에서 배울 내용들이 global 객체 안에 있습니다.  
전역 객체라는 점을 이요하여 간단한 데이터를 파일끼리 공유할 때 사용하기도 합니다. globalA.js와 globalB.js를 같은 폴더에 생성해봅시다.  
globalA 모듈의 함수는 global.message 값을 반환합니다. globalB.js에서는 global 객체에 속성명이 message인 값을 대입하고 globalA 모듈의 함수를 호출합니다. 콘솔 결과를 보면 globalB에서 넣은 global.message 값을 globalA에서도 접근할 수 있음을 알 수 있습니다.

### 2. console

console 객체는 보통 디버깅을 위해 사용됩니다. 개발 중 변수에 값이 제대로 들어 있나 확인하기 위해 사용하기도 하고, 에러 발생 시 에러 내용을 콘솔에 표시하기 위해서도 사용하며, 코드 실행 시간을 알아보려고 할 때도 사용합니다.

1. console.time(레이블)
   - console.timeEnd(레이블) 과 대응되어 같은 레이블을 가진 time과 timeEnd 사이의 시간을 측정합니다.
   - ```
        console.time('시간 측정');
        for(let i = 0; i < 100000; i++) {
            continue;
        }
        console.timeEnd('시간 측정');
     ```
2. console.log(내용)
   - 평범한 로그를 콘솔에 표시합니다. console.log(내용, 내용, ...)처럼 여러 내용을 동시에 표시할 수도 있습니다.
3. console.error(에러 내용)
   - 에러를 콘솔에 표시합니다.
4. console.dir(객체, 옵션)
   - 객체를 콘솔에 표시할 때 사용합니다. 첫 번째 인자로 표시할 객체를 넣고, 두 번째 인자로 옵션을 넣습니다. 옵션의 colors를 true로 하면 콘솔에 색이 추가되어 보기가 한결 편해집니다. depth는 객체 안의 객체를 몇 단계까지 보여줄지를 결정합니다. 기본값은 2 입니다.
   - ```
        console.dir(obj, { colors: false, depth: 2});
        console.dir(obj, { colors: true, depth: 1});
     ```
5. console.trace(레이블)
   - 에러가 어디서 발생했는지 추적할 수 있게 해줍니다. 보통은 에러 발생 시 에러 위치를 알려주므로 자주 사용하지는 않지만, 위치가 나오지 않는다면 사용할만 합니다.

### 3. 타이머

setTimeout, setInterval, setImmediate는 노드에서 window대신 global 객체 안에 들어 있습니다.

1. setTimeout(콜백 함수, 밀리초)
   - 주어진 밀리초(1000분의 1초) 이후에 콜백 함수를 실행합니다.
2. setInterval(골백 함수, 밀리초)
   - 주어진 밀리초마다 콜백 함수를 반복 실행합니다.
3. setImmediate(콜백 함수)
   - 콜백 함수를 즉시 실행합니다.

이 타이머 함수들은 모두 아이디를 반환합니다. 아이디를 사용하여 타이머를 취소할 수 있습니다.

1. clearTimeout(아이디)
   - setTimeout을 취소합니다.
2. clearInterval(아이디)
   - setInterval을 취소합니다.
3. clearImmediate(아이디)
   - setImmediate를 취소합니다.

### 4. \_\_filename, \_\_dirname

노드에서는 파일 사이에 모듈 관계가 있는 경우가 많아 현재 파일의 경로나 파일명을 알아야 하는 경우가 있습니다. 노드는 \_\_filename, \_\_dirname이라는 키워드로 경로에 대한 정보를 제공합니다.  
파일에 \_\_filename과 \_\_dirname을 넣어두면 실행 시 현재 파일명과 파일 경로로 바뀝니다.

### 5. module, exports

지금까지는 모듈을 만들 때 module.exports만 사용했는데, module 객체 말고 exports 객체로도 모듈을 만들 수 있습니다.

```
exports.odd = '홀수입니다.'
exports.even = '짤수입니다.'
```

module.exports로 한 번에 대입하는 대신, 각각의 변수를 exports 객체에 하나씩 넣었습니다. **_동일하게 동작하는 이유는 module.exports와 exports가 같은 객체를 참조하기 때문입니다._**  
실제로 console.log(module.exports === exports)를 하면 true가 나옵니다. 따라서 exports 객체에 add함수를 넣으면 module.exports에도 add 함수가 들어갑니다.

### 6. process

process 객체는 현재 실행되고 있는 노드 프로세스에 대한 정보를 담고 있습니다. provess 객체 안에는 다양한 속성이 있습니다.

1. process.version
   - 설치된 노드의 버전입니다.
2. process.arch
   - 프로세서 아키텍처 정보입니다. arm, ia32 등의 값일 수도 있습니다.
3. process.platform
   - 운영체제 플랫폼 정보입니다. linux나 darwin, freebsd, win32등의 값일 수도 있습니다.
4. process.pid
   - 현재 프로세스의 아이디입니다. 프로세스를 여러 개 가질 때 구분할 수 있습니다.
5. process.uptime()
   - 프로세스가 시작된 후 흐른 시간입니다. 단위는 초입니다.
6. process.execPath
   - 노드의 경로입니다.
7. process.cwd()
   - 현재 프로세스가 실행되는 위치입니다.
8. process.cpuUsage()
   - 현재 cpu 사용량입니다.

#### 6.1 process.env

REPL에 process.env를 입력하면 매우 많은 정보가 출력됩니다. 자세히 보면 이 정보들이 시스템의 환경 변수임을 알 수 있습니다.  
process.env는 서비스의 중요한 키를 저장하는 공간으로도 사용됩니다. 서버나 데이터베이스의 비밀번호와 각종 API키를 코드에 직접 입력하는 것은 위험합니다. 혹여 서비스가 해킹당해 코드가 유출되었을 때 비밀번호가 코드에 남아 있어 추가 피해가 발생할 수 있습니다.  
따라서 중요한 비밀번호는 다음과 같이 process.env의 속성으로 대체합니다.

```
const secretId = process.env.SECRET_ID;
const secretCode = process.env.SECRET_CODE;
```

이제 process.env에 직접 SECRET_ID와 SECRET_CODE를 넣어주면 됩니다. 넣는 방법은 운영체제마다 차이가 있습니다. 하지만 한번에 모든 운영체제에 동일하게 넣을 수 있는 방법이 있습니다. dotenv를 사용할 때 배웁니다.

#### 6.2 process.nextTick(콜백)

이벤트 루프가 다른 콜백 함수들보다 nextTick의 콜백 함수를 우선으로 처리하도록 만듭니다.
process.nextTick은 setImmediate나 setTimeout보다 먼저 실행됩니다. 또한 resolve된 Promise도 nextTick처럼 다른 콜백들보다 우선시 됩니다. 그래서 **_process.nextTick과 Promise를 마이크로태스크(microtask)라고 따로 구분지어 부릅니다._**

#### 6.3 process.exit(코드)

실행 중인 노드 프로세스를 종료합니다. 서버에 이 함수를 사용하면 서버가 멈추므로 서버에는 거의 사용하지 않습니다. 하지만 서버 외의 독립적인 프로그램에서는 수동으로 노드를 멈추게 하기 위해 사용합니다.
setInterval로 반복되고 있는 코드를 process.exit()로 멈출 수 있습니다.

```
   let i = 1;
   setInterval(() => {
      if(i === 5) {
         console.log('종료');
         process.exit();
      }
      console.log(i);
      i += 1;
   });
```

process.exit 메서드는 인자로 코드 번호를 줄 수 있습니다. 인자를 주지 않거나 0이면 정상 종료를 뜻하고, 1을 주면 비정상 종료를 뜻합니다. 만약 에러가 발생해서 종료하는 경우에는 1을 넣어주면 됩니다.

# 노드 내장 모듈 사용하기

노드는 웹 브라우저에서 사용되는 자바스크립트보다 더 많은 기능을 제공합니다. 운영체제 정보에도 접근할 수 있고, 클라이언트가 요청한 주소에 대한 정보도 가져올 수 있습니다. 바로 노드에서 제공하는 모듈을 사용하면 됩니다.

### 1. os

os 모듈은 운영체제의 정보를 가져올 수 있습니다.

1. os.arch()
   - process.arch와 동일합니다.
2. os.platform()
   - process.platform과 동일합니다.
3. os.type()
   - 운영체제의 종류를 보여줍니다.
4. os.uptime()
   - 운영체제 부팅 이후 흐른 시간(초)를 보여줍니다. process.uptime()은 노드의 실행 시간이었습니다.
5. os.hostname()
   - 컴퓨터의 이름을 보여줍니다.
6. os.release()
   - 운영체제의 버전을 보여줍니다.
7. os.homedir()
   - 홈 디렉터리 경로를 보여줍니다.
8. os.tmpdir()
   - 임시 파일 저장 경로를 보여줍니다.
9. os.cpus()
   - 컴퓨터의 코어 정보를 보여줍니다.
10. os.freemem()

    - 사용 가능한 메모리(RAM)를 보여줍니다.

11. os.totalmem()

    - 전체 메모리 용량을 보여줍니다.

12. os.constants 객체
    - 각종 에러와 신호에 대한 정보가 담겨 있습니다. 에러가 발생했을 때, EADDRINUSE나 ECONNRESET 같은 에러 코드를 함께 보여줍니다.

os 모듈은 주로 컴퓨터 내부 자원에 빈번하게 접근하는 경우 사용됩니다. 즉, 일반적인 웹 서비스를 제작할 때는 사용 빈도가 높지 않습니다. 하지만 운영체제별로 다른 서비스를 제공하고 싶을 때 os 모듈이 유용할 것입니다.
